(function ($, Drupal) {

    'use strict';

    Drupal.behaviors.ibucalc = {
        attach: function (context, settings) {
            // get field value on change/keyup
            var formClass = '.ibu-calculator';
            var alphaAcidsClass = 'input.alpha-acid';
            var weightClass = 'input.hop-weight';
            var contactTimeClass = 'input.hop-contact-time';

            var alphaAcids = 0;
            var hopWeight = 0;
            var hopContactTime = 0;
            var ibu = 0;
            var gravity = 0;
            var og = 0;
            var utilizationData = 0;

            $(formClass + ' input[type=text]').each(function() {
                $(this).on('autocompletechange change keyup', function () {
                    alphaAcids = $("input.alpha-acid").val();
                    hopWeight = $("input.hop-weight").val();
                    hopContactTime = $("input.hop-contact-time").val();

                    gravity = $("input.wort-gravity").val();
                    og = platoToOG(gravity);
                    console.log(og);

                    utilizationData = calculateUtlilization(3, 1.030);
                    console.log(utilizationData);
                    // utilization
                    // ibu calculation.
                    ibu = ((alphaAcids/100) * 0.2 * hopWeight * 1000) * 10;

                    if (ibu != 0) {
                        $('.ibu-value').text("IBU: " + ibu);
                    }
                }).change();

            });

            function calculateUtlilization($contactTime, $og) {
                var utilization = {
                    3: {
                        1.030: 0.034,
                        1.040: 0.031,
                        1.050: 0.029,
                        1.060: 0.026,
                        1.070: 0.024,
                        1.080: 0.022,
                        1.090: 0.020,
                        1.100: 0.018,
                        1.110: 0.017,
                        1.120: 0.015,
                        1.130: 0.014
                    },
                    6: {
                        1.030: 0.065,
                        1.040: 0.059,
                        1.050: 0.054,
                        1.060: 0.049,
                        1.070: 0.045,
                        1.080: 0.041,
                        1.090: 0.038,
                        1.100: 0.035,
                        1.110: 0.032,
                        1.120: 0.029,
                        1.130: 0.026
                    },
                    9: {
                        1.030: 0.092,
                        1.040: 0.084,
                        1.050: 0.077,
                        1.060: 0.070,
                        1.070: 0.064,
                        1.080: 0.059,
                        1.090: 0.054,
                        1.100: 0.049,
                        1.110: 0.045,
                        1.120: 0.041,
                        1.130: 0.037
                    },
                    12: {
                        1.030: 0.116,
                        1.040: 0.106,
                        1.050: 0.097,
                        1.060: 0.088,
                        1.070: 0.081,
                        1.080: 0.074,
                        1.090: 0.068,
                        1.100: 0.062,
                        1.110: 0.056,
                        1.120: 0.052,
                        1.130: 0.047
                    },
                    15: {
                        1.030: 0.137,
                        1.040: 0.125,
                        1.050: 0.114,
                        1.060: 0.105,
                        1.070: 0.096,
                        1.080: 0.087,
                        1.090: 0.080,
                        1.100: 0.073,
                        1.110: 0.067,
                        1.120: 0.061,
                        1.130: 0.056
                    },
                    18: {
                        1.030: 0.156,
                        1.040: 0.142,
                        1.050: 0.130,
                        1.060: 0.119,
                        1.070: 0.109,
                        1.080: 0.099,
                        1.090: 0.091,
                        1.100: 0.083,
                        1.110: 0.076,
                        1.120: 0.069,
                        1.130: 0.063
                    },
                    21: {
                        1.030: 0.173,
                        1.040: 0.158,
                        1.050: 0.144,
                        1.060: 0.132,
                        1.070: 0.120,
                        1.080: 0.110,
                        1.090: 0.101,
                        1.100: 0.092,
                        1.110: 0.084,
                        1.120: 0.077,
                        1.130: 0.070
                    },
                    24: {
                        1.030: 0.187,
                        1.040: 0.171,
                        1.050: 0.157,
                        1.060: 0.143,
                        1.070: 0.131,
                        1.080: 0.120,
                        1.090: 0.109,
                        1.100: 0.100,
                        1.110: 0.091,
                        1.120: 0.083,
                        1.130: 0.076
                    },
                    27: {
                        1.030: 0.201,
                        1.040: 0.183,
                        1.050: 0.168,
                        1.060: 0.153,
                        1.070: 0.140,
                        1.080: 0.128,
                        1.090: 0.117,
                        1.100: 0.107,
                        1.110: 0.098,
                        1.120: 0.089,
                        1.130: 0.082
                    },
                    30: {
                        1.030: 0.212,
                        1.040: 0.194,
                        1.050: 0.177,
                        1.060: 0.162,
                        1.070: 0.148,
                        1.080: 0.135,
                        1.090: 0.124,
                        1.100: 0.113,
                        1.110: 0.103,
                        1.120: 0.094,
                        1.130: 0.086
                    },
                    33: {
                        1.030: 0.223,
                        1.040: 0.203,
                        1.050: 0.186,
                        1.060: 0.170,
                        1.070: 0.155,
                        1.080: 0.142,
                        1.090: 0.130,
                        1.100: 0.119,
                        1.110: 0.108,
                        1.120: 0.099,
                        1.130: 0.091
                    },
                    36: {
                        1.030: 0.232,
                        1.040: 0.212,
                        1.050: 0.194,
                        1.060: 0.177,
                        1.070: 0.162,
                        1.080: 0.148,
                        1.090: 0.135,
                        1.100: 0.124,
                        1.110: 0.113,
                        1.120: 0.103,
                        1.130: 0.094
                    },
                    39: {
                        1.030: 0.240,
                        1.040: 0.219,
                        1.050: 0.200,
                        1.060: 0.183,
                        1.070: 0.167,
                        1.080: 0.153,
                        1.090: 0.140,
                        1.100: 0.128,
                        1.110: 0.117,
                        1.120: 0.107,
                        1.130: 0.098
                    },
                    42: {
                        1.030: 0.247,
                        1.040: 0.226,
                        1.050: 0.206,
                        1.060: 0.189,
                        1.070: 0.172,
                        1.080: 0.158,
                        1.090: 0.144,
                        1.100: 0.132,
                        1.110: 0.120,
                        1.120: 0.110,
                        1.130: 0.101
                    },
                    45: {
                        1.030: 0.253,
                        1.040: 0.232,
                        1.050: 0.212,
                        1.060: 0.194,
                        1.070: 0.177,
                        1.080: 0.162,
                        1.090: 0.148,
                        1.100: 0.135,
                        1.110: 0.123,
                        1.120: 0.113,
                        1.130: 0.103
                    },
                    48: {
                        1.030: 0.259,
                        1.040: 0.237,
                        1.050: 0.216,
                        1.060: 0.198,
                        1.070: 0.181,
                        1.080: 0.165,
                        1.090: 0.151,
                        1.100: 0.138,
                        1.110: 0.126,
                        1.120: 0.115,
                        1.130: 0.105
                    },
                    51: {
                        1.030: 0.264,
                        1.040: 0.241,
                        1.050: 0.221,
                        1.060: 0.202,
                        1.070: 0.184,
                        1.080: 0.169,
                        1.090: 0.154,
                        1.100: 0.141,
                        1.110: 0.129,
                        1.120: 0.118,
                        1.130: 0.108
                    },
                    54: {
                        1.030: 0.269,
                        1.040: 0.246,
                        1.050: 0.224,
                        1.060: 0.205,
                        1.070: 0.188,
                        1.080: 0.171,
                        1.090: 0.157,
                        1.100: 0.143,
                        1.110: 0.131,
                        1.120: 0.120,
                        1.130: 0.109
                    },
                    57: {
                        1.030: 0.273,
                        1.040: 0.249,
                        1.050: 0.228,
                        1.060: 0.208,
                        1.070: 0.190,
                        1.080: 0.174,
                        1.090: 0.159,
                        1.100: 0.145,
                        1.110: 0.133,
                        1.120: 0.121,
                        1.130: 0.111
                    },
                    60: {
                        1.030: 0.276,
                        1.040: 0.252,
                        1.050: 0.231,
                        1.060: 0.211,
                        1.070: 0.193,
                        1.080: 0.176,
                        1.090: 0.161,
                        1.100: 0.147,
                        1.110: 0.135,
                        1.120: 0.123,
                        1.130: 0.112
                    },
                    70: {
                        1.030: 0.285,
                        1.040: 0.261,
                        1.050: 0.238,
                        1.060: 0.218,
                        1.070: 0.199,
                        1.080: 0.182,
                        1.090: 0.166,
                        1.100: 0.152,
                        1.110: 0.139,
                        1.120: 0.127,
                        1.130: 0.116
                    },
                    80: {
                        1.030: 0.291,
                        1.040: 0.266,
                        1.050: 0.243,
                        1.060: 0.222,
                        1.070: 0.203,
                        1.080: 0.186,
                        1.090: 0.170,
                        1.100: 0.155,
                        1.110: 0.142,
                        1.120: 0.130,
                        1.130: 0.119
                    },
                    90: {
                        1.030: 0.295,
                        1.040: 0.270,
                        1.050: 0.247,
                        1.060: 0.226,
                        1.070: 0.206,
                        1.080: 0.188,
                        1.090: 0.172,
                        1.100: 0.157,
                        1.110: 0.144,
                        1.120: 0.132,
                        1.130: 0.120
                    },
                    120: {
                        1.030: 0.301,
                        1.040: 0.275,
                        1.050: 0.252,
                        1.060: 0.230,
                        1.070: 0.210,
                        1.080: 0.192,
                        1.090: 0.176,
                        1.100: 0.161,
                        1.110: 0.147,
                        1.120: 0.134,
                        1.130: 0.123
                    }
                };

                if ($contactTime <= 1) {
                    return 0;
                } else {
                    return utilization[$contactTime][$og];
                }

            }

            function platoToOG($plato) {
                var sg = 0;
                if ($plato > 0) {
                    sg = 1 + ($plato / (258.6 - (($plato / 258.2) * 227.1)));
                }

                return sg;
            }
        }
    };


})(jQuery, Drupal);
